# Development Dockerfile with SDK for running migrations
FROM mcr.microsoft.com/dotnet/sdk:9.0
WORKDIR /app

# Copy Directory.Packages.props (Central Package Management)
COPY Directory.Packages.props ./

# Copy solution and project files
COPY eCommerce.ProductsService/eCommerce.ProductsService.sln ./eCommerce.ProductsService/
COPY eCommerce.ProductsService/eCommerce.Api/eCommerce.Api.csproj ./eCommerce.ProductsService/eCommerce.Api/
COPY eCommerce.ProductsService/eCommerce.Core/eCommerce.Core.csproj ./eCommerce.ProductsService/eCommerce.Core/
COPY eCommerce.ProductsService/eCommerce.Infraestructure/eCommerce.Infraestructure.csproj ./eCommerce.ProductsService/eCommerce.Infraestructure/

# Restore dependencies
WORKDIR /app/eCommerce.ProductsService
RUN dotnet restore

# Copy all source files
COPY eCommerce.ProductsService/eCommerce.Api/ ./eCommerce.Api/
COPY eCommerce.ProductsService/eCommerce.Core/ ./eCommerce.Core/
COPY eCommerce.ProductsService/eCommerce.Infraestructure/ ./eCommerce.Infraestructure/

# Build the application
WORKDIR /app/eCommerce.ProductsService/eCommerce.Api
RUN dotnet build -c Release

EXPOSE 8080
EXPOSE 8081

CMD ["dotnet", "run", "--no-build", "--no-restore"]
